<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SeifiSau ‚Äì Sauenplaner</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color:#f8fafc; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    .btn { display:inline-flex; align-items:center; gap:0.25rem; border-radius:9999px; border:1px solid #e2e8f0; padding:0.25rem 0.75rem; background:#0f172a; color:#f9fafb; font-size:0.8rem; box-shadow:0 1px 2px rgba(15,23,42,.06); }
    .btn.secondary { background:#fff; color:#0f172a; }
    .btn.danger { background:#fee2e2; color:#b91c1c; border-color:#fecaca; }
    .btn-icon { display:inline-flex; align-items:center; justify-content:center; width:1.75rem; height:1.75rem; border-radius:9999px; border:1px solid #e2e8f0; background:#fff; font-size:0.8rem; }
    .btn-ghost { display:inline-flex; align-items:center; gap:0.25rem; padding:0.25rem 0.5rem; border-radius:9999px; border:1px solid transparent; background:transparent; font-size:0.8rem; color:#0f172a; }
    .btn-ghost:hover { border-color:#e2e8f0; background:#f8fafc; }
    .pill { display:inline-flex; align-items:center; gap:0.25rem; border-radius:9999px; padding:0.1rem 0.5rem; font-size:0.7rem; border:1px solid #e2e8f0; background:#fff; }
    .pill-muted { background:#f1f5f9; color:#64748b; }
    .pill-badge { background:#0f172a; color:#f9fafb; border-color:#0f172a; }
    .pill-warning { background:#fef9c3; color:#854d0e; border-color:#facc15; }
    .pill-danger { background:#fee2e2; color:#b91c1c; border-color:#fecaca; }
    .pill-outline { background:transparent; border-style:dashed; }
    .badge { display:inline-flex; align-items:center; justify-content:center; min-width:1.2rem; height:1.2rem; border-radius:9999px; background:#0f172a; color:#f9fafb; font-size:0.65rem; }
    .chip { display:inline-flex; align-items:center; gap:0.25rem; border-radius:9999px; padding:0.1rem 0.5rem; font-size:0.7rem; border:1px solid #e2e8f0; background:#fff; }
    .muted { color:#64748b; font-size:0.7rem; }
    .card { border-radius:1rem; border:1px solid #e2e8f0; background:#fff; }
    .card-soft { border-radius:1rem; border:1px dashed #e2e8f0; background:#f8fafc; }
    .hstack { display:flex; align-items:center; gap:0.35rem; }
    .vstack { display:flex; flex-direction:column; gap:0.2rem; }
    .divider { border-top:1px dashed #e2e8f0; margin:0.5rem 0; }
    .shadow-soft { box-shadow:0 1px 2px rgba(15,23,42,.06); }
    .shadow-soft-lg { box-shadow:0 10px 25px rgba(15,23,42,.06); }
    .gradient-bar { height:4px; border-radius:9999px; background:linear-gradient(to right,#0f172a,#22c55e); }
    .timeline-dot { width:0.5rem; height:0.5rem; border-radius:9999px; background:#0f172a; box-shadow:0 0 0 3px rgba(15,23,42,.1); }
    .timeline-line { position:absolute; left:0.25rem; top:0; bottom:0; width:1px; background:linear-gradient(to bottom,#e2e8f0,transparent); }
    .badge-pill { border-radius:9999px; border:1px solid #e2e8f0; padding:0.1rem 0.4rem; font-size:0.65rem; background:#f8fafc; }
    .badge-pill-strong { background:#0f172a; color:#f9fafb; border-color:#0f172a; }
    .table-header { font-size:0.7rem; text-transform:uppercase; letter-spacing:.08em; color:#64748b; }
    .table-cell { font-size:0.8rem; }
    .input { border-radius:0.55rem; border:1px solid #e2e8f0; padding:0.25rem 0.5rem; font-size:0.8rem; width:100%; }
    .input:disabled { background:#f8fafc; color:#64748b; }
    .select { border-radius:0.55rem; border:1px solid #e2e8f0; padding:0.25rem 0.5rem; font-size:0.8rem; width:100%; }
    th, td { padding:0.2rem 0.4rem; }
  </style>
  <!-- jsPDF f√ºr PDF-Export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
<div id="root"></div>


<!-- React -->
<script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<script type="text/babel">

const { useState, useEffect, useMemo } = React;


// Konstante f√ºr LocalStorage-Key
const STORAGE_KEY = "seifisau_bestand";


// Hilfsfunktionen
function parseDate(dateStr){
  if(!dateStr) return null;
  const [y,m,d] = dateStr.split("-").map(Number);
  return new Date(y,m-1,d);
}
function formatDate(date){
  if(!date) return "";
  const d = new Date(date);
  const pad = (x)=>String(x).padStart(2,"0");
  return d.getFullYear()+"-"+pad(d.getMonth()+1)+"-"+pad(d.getDate());
}
function diffDays(a,b){
  const ONE_DAY = 24*60*60*1000;
  return Math.round((b-a)/ONE_DAY);
}
function todayStr(){
  return formatDate(new Date());
}
function round1(v){
  if(v===null || v===undefined || isNaN(v)) return null;
  return Math.round(v*10)/10;
}


// Tier-Typen
const ART = {
  SAU: "Sau",
  EBER: "Eber",
  FERKEL: "Ferkel"
};
const STATUS = {
  AKTIV: "aktiv",
  ABGANG: "abgang",
  TOT: "tot",
  VERKAUFT: "verkauft"
};
const GEBURTSGRUND = {
  WURF: "Wurf",
  ZUKAUF: "Zukauf",
  UEBERNOMMEN: "√úbernommen"
};


// Beispiel-Bestand
function initialAnimals(){
  const today = todayStr();
  return [
    {
      id: "S-001",
      name: "Lotte",
      art: ART.SAU,
      geburtsdatum: "2023-03-15",
      abstammung: "Landrasse √ó Pietrain",
      herkunft: "Eigenzucht",
      gewichtStart: 120,
      status: STATUS.AKTIV,
      stall: "Box 3",
      gruppe: "Deckgruppe",
      notizen: "Ruhige Sau, gute Klauen",
      wurfausfaelle: [
        { datum:"2023-09-20", lebend:12, tot:1, abgesetzt:11, bemerkung:"Sehr guter Wurf" }
      ],
      behandlungen: [
        { datum:"2023-10-10", mittel:"Impfung Parvo", dosis:"2 ml", grund:"Impfplan", ta:"Dr. Huber" }
      ]
    },
    {
      id: "E-010",
      name: "Bruno",
      art: ART.EBER,
      geburtsdatum: "2022-11-05",
      abstammung: "DU √ó Pi",
      herkunft: "Zukauf Besamungsstation",
      gewichtStart: 180,
      status: STATUS.AKTIV,
      stall: "Eberbucht 1",
      gruppe: "Eber",
      notizen: "Sehr agil, gute Libido",
      wurfausfaelle: [],
      behandlungen: [
        { datum:"2023-08-01", mittel:"Entwurmung", dosis:"nach KG", grund:"Bestandsbehandlung", ta:"Dr. Maier" }
      ]
    },
    {
      id: "F-045",
      name: "Fritz",
      art: ART.FERKEL,
      geburtsdatum: today,
      abstammung: "Lotte √ó Bruno",
      herkunft: "Eigenzucht",
      gewichtStart: 1.4,
      status: STATUS.AKTIV,
      stall: "Ferkelabteil 1",
      gruppe: "Wurf Lotte 2023-09",
      notizen: "Etwas kleiner, aber fit",
      wurfausfaelle: [],
      behandlungen: []
    }
  ];
}



// Komponente: Badge
function Badge({children,variant="default"}){
  let cls = "badge-pill";
  if(variant==="strong") cls += " badge-pill-strong";
  if(variant==="warn") cls += " pill-warning";
  if(variant==="danger") cls += " pill-danger";
  return React.createElement("span",{className:cls},children);
}


// Komponente: Pill
function Pill({children,variant="default"}){
  let cls = "pill";
  if(variant==="muted") cls += " pill-muted";
  if(variant==="warn") cls += " pill-warning";
  if(variant==="danger") cls += " pill-danger";
  if(variant==="outline") cls += " pill-outline";
  return React.createElement("span",{className:cls},children);
}


// Komponente: Status-Badge
function StatusBadge({tier}){
  if(tier.statusIgnorieren){
    return React.createElement(Pill,{variant:"muted"},"Ignoriert");
  }
  if(tier.status===STATUS.ABGANG){
    return React.createElement(Pill,{variant:"danger"},"Abgang");
  }
  if(tier.status===STATUS.TOT){
    return React.createElement(Pill,{variant:"danger"},"Verendet");
  }
  if(tier.status===STATUS.VERKAUFT){
    return React.createElement(Pill,{variant:"outline"},"Verkauft");
  }
  return React.createElement(Pill,null,"Aktiv");
}


// Komponente: Art-Tag
function ArtTag({art}){
  let label = art || "?";
  let variant = "muted";
  if(art===ART.SAU) variant = "default";
  if(art===ART.EBER) variant = "outline";
  if(art===ART.FERKEL) variant = "muted";
  return React.createElement(Pill,{variant},label);
}


// Komponente: Timeline-Punkt
function TimelineItem({date,label,sub}){
  return React.createElement("div",{className:"relative pl-4 pb-2 text-xs"},
    React.createElement("div",{className:"timeline-line"}),
    React.createElement("div",{className:"timeline-dot"}),
    React.createElement("div",{className:"ml-4"},
      React.createElement("div",{className:"font-medium"},label),
      date && React.createElement("div",{className:"muted"},date),
      sub && React.createElement("div",{className:"text-[0.65rem] text-slate-600 mt-0.5"},sub)
    )
  );
}


// Komponente: Tierkarte
function AnimalCard({tier,selected,onToggleSelect,onOpen,markiert}){
  const geburtsDatum = tier.geburtsdatum ? parseDate(tier.geburtsdatum) : null;
  const alterTage = geburtsDatum ? diffDays(geburtsDatum,new Date()) : null;
  const alterText = alterTage!==null ? (alterTage<60 ? alterTage+" Tage" : (Math.round(alterTage/30.4)+" Monate")) : "‚Äì";

  const letzteWurf = tier.wurfausfaelle && tier.wurfausfaelle.length>0
    ? tier.wurfausfaelle[tier.wurfausfaelle.length-1]
    : null;

  const titelZeile = tier.name || tier.id || "Unbenannt";

  return React.createElement("div",{
      className:
        "card shadow-soft px-3 py-2 sm:px-3 sm:py-3 flex gap-2 cursor-pointer hover:shadow-soft-lg transition-shadow "+
        (selected ? "ring-2 ring-slate-900/70" : "")
    },
    React.createElement("div",{className:"flex flex-col items-center gap-1 pr-2"},
      React.createElement("button",{
        className:"btn-icon",
        onClick:(e)=>{
          e.stopPropagation();
          onToggleSelect();
        }
      }, selected ? "‚úì" : "‚óã"),
      React.createElement("span",{className:"text-[0.6rem] text-slate-500"}, tier.id || "‚Äì")
    ),
    React.createElement("div",{className:"flex-1 flex flex-col gap-1",onClick:onOpen},
      React.createElement("div",{className:"flex items-start gap-2"},
        React.createElement("div",{className:"flex-1"},
          React.createElement("div",{className:"flex items-center gap-2"},
            React.createElement("span",{className:"font-semibold text-sm text-slate-900"},titelZeile),
            React.createElement(ArtTag,{art:tier.art}),
            React.createElement(StatusBadge,{tier})
          ),
          React.createElement("div",{className:"flex flex-wrap gap-2 mt-0.5"},
            tier.abstammung && React.createElement(Pill,{variant:"muted"},tier.abstammung),
            tier.herkunft && React.createElement(Pill,{variant:"muted"},"Herkunft: ",tier.herkunft),
            tier.gruppe && React.createElement(Pill,{variant:"muted"},"Gruppe: ",tier.gruppe)
          )
        ),
        React.createElement("div",{className:"text-right text-[0.7rem] text-slate-600 min-w-[5.5rem]"},
          tier.gewichtStart ? React.createElement("div",null,"Start: ",tier.gewichtStart," kg") : null,
          geburtsDatum && React.createElement("div",null,"geb. ",tier.geburtsdatum),
          alterTage!==null && React.createElement("div",{className:"muted"},"Alter: ",alterText)
        )
      ),
      React.createElement("div",{className:"mt-2 flex items-center gap-3 text-[0.7rem]"},
        letzteWurf ? React.createElement("div",{className:"flex items-center gap-1"},
          React.createElement("span",{className:"font-medium"},"Letzter Wurf:"),
          React.createElement("span",null,letzteWurf.lebend," lebend / ",letzteWurf.abgesetzt," abgesetzt")
        ) : React.createElement("div",{className:"muted"},"Bisher kein Wurf erfasst"),
        React.createElement("div",{className:"ml-auto flex items-center gap-1"},
          tier.behandlungen && tier.behandlungen.length>0
            ? React.createElement(Pill,{variant:"muted"},
                "Behandlungen: ",tier.behandlungen.length
              )
            : React.createElement(Pill,{variant:"outline"},"Keine Behandlungen"),
          tier.notizen ? React.createElement("span",{className:"muted"}, "Notizen vorhanden") : null
        )
      )
    )
  );
}



// Dialog zur Erfassung/Bearbeitung
function AnimalDialog({animalForm,setAnimalForm,animalDialog,onSave,onClose}){
  if(!animalDialog.open) return null;

  const tier = animalDialog.tier || {};

  const updateField = (field,value)=>{
    setAnimalForm(prev=>({...prev,[field]:value}));
  };

  const updateAbgang = (field,value)=>{
    setAnimalForm(prev=>({
      ...prev,
      abgang:{
        ...(prev.abgang||{}),
        [field]:value
      }
    }));
  };

  const onSubmit = (e)=>{
    e.preventDefault();
    onSave();
  };

  const isAbgang = animalForm.status===STATUS.ABGANG || animalForm.status===STATUS.TOT || animalForm.status===STATUS.VERKAUFT;

  const istNeu = !animalDialog.tier;

  return React.createElement("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},
    React.createElement("div",{className:"bg-white rounded-2xl shadow-soft-lg max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden flex flex-col"},
      React.createElement("div",{className:"px-4 py-3 border-b flex items-center gap-2"},
        React.createElement("div",{className:"flex flex-col"},
          React.createElement("div",{className:"flex items-center gap-2"},
            React.createElement("h2",{className:"text-sm font-semibold text-slate-900"},
              istNeu ? "Neues Tier anlegen" : "Tier bearbeiten"
            ),
            animalForm.status && React.createElement(StatusBadge,{tier:animalForm})
          ),
          React.createElement("div",{className:"muted"},
            istNeu ? "Erfasse eine neue Sau, einen Eber oder ein Ferkel." : "Passe die Daten des Tieres an."
          )
        ),
        React.createElement("div",{className:"ml-auto flex items-center gap-2"},
          React.createElement("button",{className:"btn-ghost",onClick:onClose},"Abbrechen"),
          React.createElement("button",{className:"btn",onClick:onSave},
            istNeu ? "Anlegen" : "Speichern"
          )
        )
      ),
      React.createElement("form",{onSubmit:onSubmit,className:"flex-1 overflow-auto px-4 py-3 space-y-3"},
        React.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3"},
          React.createElement("div",{className:"space-y-1"},
            React.createElement("label",{className:"text-xs font-medium text-slate-700"},"Tier-Nr."),
            React.createElement("input",{
              className:"input",
              value:animalForm.id||"",
              onChange:e=>updateField("id",e.target.value)
            })
          ),
          React.createElement("div",{className:"space-y-1"},
            React.createElement("label",{className:"text-xs font-medium text-slate-700"},"Name"),
            React.createElement("input",{
              className:"input",
              value:animalForm.name||"",
              onChange:e=>updateField("name",e.target.value)
            })
          ),
          React.createElement("div",{className:"space-y-1"},
            React.createElement("label",{className:"text-xs font-medium text-slate-700"},"Art"),
            React.createElement("select",{
              className:"select",
              value:animalForm.art||"",
              onChange:e=>updateField("art",e.target.value)
            },
              React.createElement("option",{value:""},"‚Äì w√§hlen ‚Äì"),
              React.createElement("option",{value:ART.SAU},"Sau"),
              React.createElement("option",{value:ART.EBER},"Eber"),
              React.createElement("option",{value:ART.FERKEL},"Ferkel")
            )
          )
        ),
        React.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-3"},
          React.createElement("div",{className:"space-y-1"},
            React.createElement("label",{className:"text-xs font-medium text-slate-700"},"Geburtsdatum"),
            React.createElement("input",{
              type:"date",
              className:"input",
              value:animalForm.geburtsdatum||"",
              onChange:e=>updateField("geburtsdatum",e.target.value)
            })
          ),
          React.createElement("div",{className:"space-y-1"},
            React.createElement("label",{className:"text-xs font-medium text-slate-700"},"Geburtsgewicht (kg)"),
            React.createElement("input",{
              type:"number",
              step:"0.1",
              className:"input",
              value:animalForm.gewichtStart||"",
              onChange:e=>updateField("gewichtStart",e.target.value ? parseFloat(e.target.value) : null)
            })
          ),
          React.createElement("div",{className:"space-y-1"},
            React.createElement("label",{className:"text-xs font-medium text-slate-700"},"Herkunft"),
            React.createElement("input",{
              className:"input",
              value:animalForm.herkunft||"",
              onChange:e=>updateField("herkunft",e.target.value)
            })
          ),
          React.createElement("div",{className:"space-y-1"},
            React.createElement("label",{className:"text-xs font-medium text-slate-700"},"Abstammung"),
            React.createElement("input",{
              className:"input",
              value:animalForm.abstammung||"",
              onChange:e=>updateField("abstammung",e.target.value)
            })
          )
        ),
        React.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3"},
          React.createElement("div",{className:"space-y-1"},
            React.createElement("label",{className:"text-xs font-medium text-slate-700"},"Stall/Ort"),
            React.createElement("input",{
              className:"input",
              value:animalForm.stall||"",
              onChange:e=>updateField("stall",e.target.value)
            })
          ),
          React.createElement("div",{className:"space-y-1"},
            React.createElement("label",{className:"text-xs font-medium text-slate-700"},"Gruppe/Bucht"),
            React.createElement("input",{
              className:"input",
              value:animalForm.gruppe||"",
              onChange:e=>updateField("gruppe",e.target.value)
            })
          ),
          React.createElement("div",{className:"space-y-1"},
            React.createElement("label",{className:"text-xs font-medium text-slate-700"},"Status"),
            React.createElement("select",{
              className:"select",
              value:animalForm.status||"",
              onChange:e=>updateField("status",e.target.value)
            },
              React.createElement("option",{value:""},"‚Äì w√§hlen ‚Äì"),
              React.createElement("option",{value:STATUS.AKTIV},"Aktiv"),
              React.createElement("option",{value:STATUS.VERKAUFT},"Verkauft"),
              React.createElement("option",{value:STATUS.TOT},"Verendet"),
              React.createElement("option",{value:STATUS.ABGANG},"Abgang")
            )
          )
        ),
        React.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3"},
          React.createElement("div",{className:"space-y-1"},
            React.createElement("label",{className:"text-xs font-medium text-slate-700"},"Notizen"),
            React.createElement("textarea",{
              className:"input min-h-[4rem]",
              value:animalForm.notizen||"",
              onChange:e=>updateField("notizen",e.target.value)
            })
          ),
          React.createElement("div",{className:"space-y-2"},
            React.createElement("div",{className:"flex items-center gap-2"},
              React.createElement("label",{className:"text-xs font-medium text-slate-700 flex items-center gap-1"},
                "Tier in Statistiken ignorieren"
              ),
              React.createElement("input",{
                type:"checkbox",
                checked:!!animalForm.statusIgnorieren,
                onChange:e=>updateField("statusIgnorieren",e.target.checked)
              })
            ),
            React.createElement("div",{className:"text-[0.7rem] text-slate-500"},
              "Ignorierte Tiere werden nicht in Kennzahlen/√úbersichten mitgez√§hlt."
            )
          )
        ),

        isAbgang && React.createElement("div",{className:"mt-2 card-soft border border-amber-200/70 bg-amber-50/50 px-3 py-2 rounded-xl"},
          React.createElement("div",{className:"flex items-center gap-2 mb-2"},
            React.createElement("span",{className:"text-xs font-semibold text-amber-800"},"Abgang/Verkauf"),
            React.createElement("span",{className:"muted"},"Detailangaben zum Abgang")
          ),
          React.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-3"},
            React.createElement("div",{className:"space-y-1"},
              React.createElement("label",{className:"text-xs font-medium text-slate-700"},"Datum"),
              React.createElement("input",{
                type:"date",
                className:"input",
                value:(animalForm.abgang && animalForm.abgang.datum) || "",
                onChange:e=>updateAbgang("datum",e.target.value)
              })
            ),
            React.createElement("div",{className:"space-y-1"},
              React.createElement("label",{className:"text-xs font-medium text-slate-700"},"Gewicht (kg)"),
              React.createElement("input",{
                type:"number",
                step:"0.1",
                className:"input",
                value:(animalForm.abgang && animalForm.abgang.gewicht) || "",
                onChange:e=>updateAbgang("gewicht",e.target.value ? parseFloat(e.target.value) : null)
              })
            ),
            React.createElement("div",{className:"space-y-1"},
              React.createElement("label",{className:"text-xs font-medium text-slate-700"},"Preis (‚Ç¨)"),
              React.createElement("input",{
                type:"number",
                step:"0.01",
                className:"input",
                value:(animalForm.abgang && animalForm.abgang.preis) || "",
                onChange:e=>updateAbgang("preis",e.target.value ? parseFloat(e.target.value) : null)
              })
            ),
            React.createElement("div",{className:"space-y-1"},
              React.createElement("label",{className:"text-xs font-medium text-slate-700"},"Abnehmer"),
              React.createElement("input",{
                className:"input",
                value:(animalForm.abgang && animalForm.abgang.abnehmer) || "",
                onChange:e=>updateAbgang("abnehmer",e.target.value)
              })
            )
          ),
          React.createElement("div",{className:"mt-2 grid grid-cols-1 sm:grid-cols-2 gap-3"},
            React.createElement("div",{className:"space-y-1"},
              React.createElement("label",{className:"text-xs font-medium text-slate-700"},"Grund"),
              React.createElement("input",{
                className:"input",
                value:(animalForm.abgang && animalForm.abgang.grund) || "",
                onChange:e=>updateAbgang("grund",e.target.value)
              })
            ),
            React.createElement("div",{className:"space-y-1"},
              React.createElement("label",{className:"text-xs font-medium text-slate-700"},"Bemerkung"),
              React.createElement("input",{
                className:"input",
                value:(animalForm.abgang && animalForm.abgang.bemerkung) || "",
                onChange:e=>updateAbgang("bemerkung",e.target.value)
              })
            )
          )
        )
      )
    )
  );
}


// Wurf-/Behandlungsdialoge etc. (vereinfachte Darstellung ‚Äì hier nicht einzeln ausgegliedert)


// Hauptkomponente
function App(){
  // Tiere beim Start laden: zuerst aus localStorage, sonst Demo-Bestand
  const [tiere,setTiere] = useState(() => {
    try{
      const stored = localStorage.getItem(STORAGE_KEY);
      if(stored){
        return JSON.parse(stored);
      }
    }catch(e){
      console.error("Konnte gespeicherte Daten nicht laden:", e);
    }
    return initialAnimals();
  });


  // Alle √Ñnderungen automatisch im Browser speichern
  useEffect(()=>{
    try{
      localStorage.setItem(STORAGE_KEY, JSON.stringify(tiere));
    }catch(e){
      console.error("Konnte Daten nicht in localStorage speichern:", e);
    }
  },[tiere]);


  const [filterText,setFilterText] = useState("");
  const [filterArt,setFilterArt] = useState("");
  const [filterStatus,setFilterStatus] = useState("aktiv");
  const [markiert,setMarkiert] = useState([]);
  const [animalDialog,setAnimalDialog] = useState({open:false,mode:"create",tier:null});
  const [animalForm,setAnimalForm] = useState({});
  const [tab,setTab] = useState("liste");

  // Filterlogik
  const gefiltert = useMemo(()=>{
    let res = [...tiere];
    if(filterArt){
      res = res.filter(t=>t.art===filterArt);
    }
    if(filterStatus){
      if(filterStatus==="nurAktive"){
        res = res.filter(t=>!t.status || t.status===STATUS.AKTIV);
      }else if(filterStatus==="nurAbgaenge"){
        res = res.filter(t=>t.status && t.status!==STATUS.AKTIV);
      }else if(filterStatus==="aktiv"){
        res = res.filter(t=>!t.status || t.status===STATUS.AKTIV);
      }
    }
    if(filterText){
      const q = filterText.toLowerCase();
      res = res.filter(t=>{
        return (
          (t.id && t.id.toLowerCase().includes(q)) ||
          (t.name && t.name.toLowerCase().includes(q)) ||
          (t.gruppe && t.gruppe.toLowerCase().includes(q)) ||
          (t.stall && t.stall.toLowerCase().includes(q))
        );
      });
    }
    return res;
  },[tiere,filterArt,filterStatus,filterText]);


  const stats = useMemo(()=>{
    const total = tiere.length;
    const aktiv = tiere.filter(t=>!t.status || t.status===STATUS.AKTIV).length;
    const abgang = tiere.filter(t=>t.status && t.status!==STATUS.AKTIV).length;
    const byArt = {};
    tiere.forEach(t=>{
      byArt[t.art] = (byArt[t.art]||0)+1;
    });

    // Beispiel-Kennzahlen
    let wurfAnz = 0;
    let lebendSum = 0;
    let abgesetztSum = 0;
    tiere.forEach(t=>{
      (t.wurfausfaelle||[]).forEach(w=>{
        wurfAnz++;
        lebendSum += w.lebend||0;
        abgesetztSum += w.abgesetzt||0;
      });
    });
    const durchsLebend = wurfAnz>0 ? (lebendSum/wurfAnz) : null;
    const durchsAbgesetzt = wurfAnz>0 ? (abgesetztSum/wurfAnz) : null;

    return {total,aktiv,abgang,byArt,wurfAnz,durchsLebend,durchsAbgesetzt};
  },[tiere]);


  function openNewAnimal(){
    setAnimalForm({
      id:"",
      name:"",
      art:ART.SAU,
      geburtsdatum:todayStr(),
      gewichtStart:null,
      herkunft:"",
      abstammung:"",
      stall:"",
      gruppe:"",
      notizen:"",
      status:STATUS.AKTIV,
      abgang:null,
      statusIgnorieren:false
    });
    setAnimalDialog({open:true,mode:"create",tier:null});
  }


  function openEditAnimal(tier){
    setAnimalForm({
      ...tier,
      gewichtStart: tier.gewichtStart || "",
      geburtsdatum: tier.geburtsdatum || "",
      herkunft: tier.herkunft || "",
      abstammung: tier.abstammung || "",
      stall: tier.stall || "",
      gruppe: tier.gruppe || "",
      notizen: tier.notizen || "",
      status: tier.status || STATUS.AKTIV,
      abgang: tier.abgang || null,
      statusIgnorieren: !!tier.statusIgnorieren
    });
    setAnimalDialog({open:true,mode:"edit",tier});
  }


  function saveAnimal(){
    const f = animalForm;
    const clean = {...f};
    if(clean.gewichtStart==="") clean.gewichtStart = null;

    if(!clean.art) clean.art = ART.SAU;
    if(!clean.status) clean.status = STATUS.AKTIV;

    if(animalDialog.mode==="create"){
      // Wenn keine ID vergeben, automatisch generieren
      if(!clean.id){
        const prefix = clean.art===ART.SAU ? "S" : clean.art===ART.EBER ? "E" : "F";
        const existing = tiere.filter(t=>t.art===clean.art).length;
        const nr = String(existing+1).padStart(3,"0");
        clean.id = prefix+"-"+nr;
      }
      setTiere(prev=>[...prev,clean]);
    }else{
      // bearbeiten
      setTiere(prev=>prev.map(t=>t===animalDialog.tier ? clean : t));
    }
    setAnimalDialog({open:false,mode:"create",tier:null});
  }


  function toggleMark(tier){
    setMarkiert(prev=>{
      if(prev.includes(tier)) return prev.filter(x=>x!==tier);
      return [...prev,tier];
    });
  }


  function deleteAnimals(){
    if(markiert.length===0){
      alert("Keine Tiere markiert.");
      return;
    }
    if(!confirm("Sollen die markierten Tiere wirklich gel√∂scht werden? ("+markiert.length+" St√ºck)")) return;
    setTiere(prev=>prev.filter(t=>!markiert.includes(t)));
    setMarkiert([]);
  }


  function exportJson(){
    const blob = new Blob([JSON.stringify({tiere},null,2)],{type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = "seifisau_export.json"; a.click();
    URL.revokeObjectURL(url);
  }


  function importJson(){
    const input = document.createElement("input");
    input.type = "file";
    input.accept = "application/json,.json";

    input.onchange = (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (ev) => {
        try {
          const text = ev.target.result;
          const data = JSON.parse(text);

          let neueTiere;
          if (Array.isArray(data)) {
            neueTiere = data;
          } else if (data && Array.isArray(data.tiere)) {
            neueTiere = data.tiere;
          } else {
            alert("Die Datei hat kein g√ºltiges SeifiSau-Format.");
            return;
          }

          setTiere(neueTiere);
          setMarkiert([]);
          alert("Bestand wurde erfolgreich aus der Datei geladen.");
        } catch (err) {
          console.error("Fehler beim Import:", err);
          alert("Die Datei konnte nicht gelesen werden (ung√ºltiges JSON?).");
        }
      };

      reader.readAsText(file, "utf-8");
    };

    input.click();
  }


function resetData(){
    if(!confirm("Wirklich alle Daten l√∂schen und mit Demo-Bestand neu starten?")) return;
    try{ localStorage.removeItem(STORAGE_KEY); }catch(e){}
    setTiere(initialAnimals());
    setMarkiert([]);
  }


  const gefiltertMitMark = gefiltert;


  return React.createElement("div",{className:"min-h-screen"},
    /* Kopf */
    React.createElement("div",{className:"border-b bg-white"},
      React.createElement("div",{className:"mx-auto max-w-7xl px-4 py-2 flex items-center justify-between gap-2"},
        React.createElement("div",{className:"flex flex-col gap-0.5"},
          React.createElement("div",{className:"flex items-center gap-2"},
            React.createElement("div",{className:"flex items-center gap-2"},
              React.createElement("span",{className:"text-lg"},"üê∑"),
              React.createElement("span",{className:"font-semibold text-sm tracking-tight text-slate-900"},
                "SeifiSau"
              )
            ),
            React.createElement("span",{className:"badge-pill bg-emerald-100 text-emerald-800 border border-emerald-200/80"},
              "Bestandsf√ºhrung"
            )
          ),
          React.createElement("div",{className:"muted"},
            "Sauen, Eber und Ferkel im Blick ‚Äì ohne Schnickschnack."
          )
        ),
        React.createElement("div",{className:"flex items-center gap-2"},
          React.createElement("button",{className:"btn secondary",onClick:openNewAnimal},
            React.createElement("span",null,"+ Neues Tier")
          )
        )
      )
    ),

    /* Inhalt */
    React.createElement("div",{className:"mx-auto max-w-7xl px-4 py-3 flex flex-col gap-3"},
      React.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3"},
        React.createElement("div",{className:"lg:col-span-2 card shadow-soft px-3 py-2"},
          React.createElement("div",{className:"flex flex-wrap items-center gap-2 mb-2"},
            React.createElement("div",{className:"flex items-center gap-2 flex-1 min-w-[12rem]"},
              React.createElement("input",{
                className:"input",
                placeholder:"Suchen nach Name, Nr., Stall, Gruppe...",
                value:filterText,
                onChange:e=>setFilterText(e.target.value)
              })
            ),
            React.createElement("div",{className:"flex items-center gap-1"},
              React.createElement("select",{
                className:"select text-xs",
                value:filterArt,
                onChange:e=>setFilterArt(e.target.value)
              },
                React.createElement("option",{value:""},"Alle Arten"),
                React.createElement("option",{value:ART.SAU},"Sauen"),
                React.createElement("option",{value:ART.EBER},"Eber"),
                React.createElement("option",{value:ART.FERKEL},"Ferkel")
              ),
              React.createElement("select",{
                className:"select text-xs",
                value:filterStatus,
                onChange:e=>setFilterStatus(e.target.value)
              },
                React.createElement("option",{value:"aktiv"},"Nur aktive"),
                React.createElement("option",{value:"nurAktive"},"Aktiv (ohne Abg√§nge)"),
                React.createElement("option",{value:"nurAbgaenge"},"Nur Abg√§nge")
              )
            )
          ),
          React.createElement("div",{className:"gradient-bar mb-2"}),
          React.createElement("div",{className:"flex flex-col gap-1 max-h-[60vh] overflow-auto pr-1"},
            gefiltertMitMark.length===0
              ? React.createElement("div",{className:"text-xs text-slate-500 py-4 text-center"},
                  "Keine Tiere gefunden. Passe die Filter an oder lege ein neues Tier an."
                )
              : gefiltertMitMark.map((t,index)=>React.createElement(AnimalCard,{
                  key:index,
                  tier:t,
                  selected:markiert.includes(t),
                  onToggleSelect:()=>toggleMark(t),
                  onOpen:()=>openEditAnimal(t),
                  markiert
                }))
          )
        ),

        React.createElement("div",{className:"flex flex-col gap-3"},
          React.createElement("div",{className:"card px-3 py-2"},
            React.createElement("div",{className:"flex items-center justify-between mb-1"},
              React.createElement("div",{className:"flex items-center gap-2"},
                React.createElement("span",{className:"text-xs font-semibold text-slate-800"},"Bestand"),
                React.createElement("span",{className:"badge-pill bg-slate-900 text-slate-50 border border-slate-900/70"},
                  stats.total," Tiere"
                )
              ),
              React.createElement("div",{className:"flex items-center gap-1 text-[0.65rem] text-slate-500"},
                React.createElement("span",null,"Aktiv: ",stats.aktiv),
                React.createElement("span",{className:"text-slate-300"},"/"),
                React.createElement("span",null,"Abg√§nge: ",stats.abgang)
              )
            ),
            React.createElement("div",{className:"grid grid-cols-3 gap-2 mt-2 text-[0.7rem]"},
              React.createElement("div",{className:"p-2 rounded-lg bg-slate-50 border border-slate-100 flex flex-col gap-0.5"},
                React.createElement("div",{className:"text-[0.65rem] text-slate-500"},"Sauen"),
                React.createElement("div",{className:"text-sm font-semibold text-slate-900"},stats.byArt[ART.SAU]||0),
                React.createElement("div",{className:"text-[0.65rem] text-slate-500"},"inkl. Jungsauen")
              ),
              React.createElement("div",{className:"p-2 rounded-lg bg-slate-50 border border-slate-100 flex flex-col gap-0.5"},
                React.createElement("div",{className:"text-[0.65rem] text-slate-500"},"Eber"),
                React.createElement("div",{className:"text-sm font-semibold text-slate-900"},stats.byArt[ART.EBER]||0),
                React.createElement("div",{className:"text-[0.65rem] text-slate-500"},"Deck- & Jungeber")
              ),
              React.createElement("div",{className:"p-2 rounded-lg bg-slate-50 border border-slate-100 flex flex-col gap-0.5"},
                React.createElement("div",{className:"text-[0.65rem] text-slate-500"},"Ferkel"),
                React.createElement("div",{className:"text-sm font-semibold text-slate-900"},stats.byArt[ART.FERKEL]||0),
                React.createElement("div",{className:"text-[0.65rem] text-slate-500"},"aufgezogen")
              )
            ),
            React.createElement("div",{className:"divider"}),
            React.createElement("div",{className:"grid grid-cols-2 gap-2 text-[0.7rem]"},
              React.createElement("div",{className:"flex flex-col gap-0.5"},
                React.createElement("div",{className:"text-[0.65rem] text-slate-500"},"√ò lebend/Wurf"),
                React.createElement("div",{className:"text-sm font-semibold text-slate-900"},
                  stats.durchsLebend!==null ? round1(stats.durchsLebend) : "‚Äì"
                ),
                React.createElement("div",{className:"text-[0.65rem] text-slate-500"},"aus ",stats.wurfAnz," W√ºrfen")
              ),
              React.createElement("div",{className:"flex flex-col gap-0.5"},
                React.createElement("div",{className:"text-[0.65rem] text-slate-500"},"√ò abgesetzt/Wurf"),
                React.createElement("div",{className:"text-sm font-semibold text-slate-900"},
                  stats.durchsAbgesetzt!==null ? round1(stats.durchsAbgesetzt) : "‚Äì"
                ),
                React.createElement("div",{className:"text-[0.65rem] text-slate-500"},"inkl. Umrauscher")
              )
            )
          ),

          React.createElement("div",{className:"card px-3 py-2"},
            React.createElement("div",{className:"flex items-center justify-between mb-2"},
              React.createElement("span",{className:"text-xs font-semibold text-slate-800"},"Markierte Tiere"),
              React.createElement("span",{className:"badge-pill bg-slate-900 text-slate-50 border border-slate-900/70"},
                markiert.length
              )
            ),
            markiert.length===0
              ? React.createElement("div",{className:"text-[0.7rem] text-slate-500"},
                  "Markiere Tiere links √ºber den Kreis, um Sammelaktionen durchzuf√ºhren."
                )
              : React.createElement("div",{className:"space-y-1 text-[0.7rem]"},
                  React.createElement("div",{className:"flex flex-wrap gap-1"},
                    markiert.slice(0,6).map((t,i)=>React.createElement("span",{key:i,className:"badge-pill"},
                      t.id || t.name || "Tier"
                    )),
                    markiert.length>6 && React.createElement("span",{className:"badge-pill-muted text-slate-500"},
                      "+",markiert.length-6," weitere"
                    )
                  ),
                  React.createElement("div",{className:"flex flex-wrap gap-1 mt-1"},
                    React.createElement("button",{
                      type:"button",
                      className:"btn-ghost text-xs",
                      onClick:deleteAnimals
                    },"Markierte l√∂schen"),
                    React.createElement("button",{
                      type:"button",
                      className:"btn-ghost text-xs",
                      onClick:()=>setMarkiert([])
                    },"Markierungen aufheben")
                  )
                )
          )
        )
      )
    ),

    animalDialog.open && React.createElement(AnimalDialog,{
      animalForm,
      setAnimalForm,
      animalDialog,
      onSave: saveAnimal,
      onClose: ()=>setAnimalDialog({open:false,mode:"create",tier:null})
    }),

    React.createElement("div",{className:"mt-2 border-t bg-white"},
      React.createElement("div",{className:"mx-auto max-w-7xl px-4 py-2 flex items-center gap-2 text-[0.7rem] text-slate-500"},
        React.createElement("div",{className:"flex items-center gap-1"},
          React.createElement("span",null,"üê∑ SeifiSau"),
          React.createElement("span",{className:"text-slate-400"},"¬∑"),
          React.createElement("span",null,"lokal im Browser, ohne Cloud.")
        ),
        React.createElement("div",{className:"flex items-center gap-2 text-[0.65rem] text-slate-400"},
          React.createElement("span",null,"Tiere: ",tiere.length),
          React.createElement("span",null,"Sauen: ",stats.byArt[ART.SAU]||0),
          React.createElement("span",null,"Eber: ",stats.byArt[ART.EBER]||0)
        ),
        React.createElement("div",{className:"ml-auto flex items-center gap-2"},
          React.createElement("button",{className:"btn",onClick:exportJson},"Export"),
          React.createElement("button",{className:"btn",onClick:importJson},"Import"),
          React.createElement("button",{className:"btn",onClick:resetData},"Daten zur√ºcksetzen")
        )
      )
    )
  );
}



// React rendern
const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(React.createElement(App));

</script>

</body>
</html>
