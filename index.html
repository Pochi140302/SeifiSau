<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SeifiSau – Sauenplaner</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color:#f8fafc; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    .btn { display:inline-flex; align-items:center; gap:0.25rem; border-radius:0.75rem; padding:0.35rem 0.75rem; border:1px solid #e2e8f0; box-shadow:0 1px 2px rgba(15,23,42,.06); background:#fff; font-size:0.8rem; }
    .btn:hover { box-shadow:0 4px 10px rgba(15,23,42,.08); }
    .tab { padding:0.35rem 0.75rem; border-radius:0.75rem; cursor:pointer; font-size:0.75rem; }
    .tab-active { background:#fff; border:1px solid #e2e8f0; box-shadow:0 1px 2px rgba(15,23,42,.06); }
    .chip { display:inline-flex; align-items:center; border-radius:999px; padding:0.1rem 0.5rem; font-size:0.7rem; border:1px solid #e2e8f0; background:#fff; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .muted { color:#64748b; font-size:0.7rem; }
    .card { border-radius:1rem; border:1px solid #e2e8f0; background:#fff; }
    .card-header { padding:0.6rem 0.9rem; border-bottom:1px solid #e2e8f0; font-weight:600; font-size:0.9rem; }
    .card-body { padding:0.75rem; font-size:0.8rem; }
    .input { border-radius:0.55rem; border:1px solid #e2e8f0; padding:0.25rem 0.5rem; font-size:0.8rem; width:100%; }
    .input:disabled { background:#f8fafc; color:#64748b; }
    .select { border-radius:0.55rem; border:1px solid #e2e8f0; padding:0.25rem 0.5rem; font-size:0.8rem; width:100%; }
    th, td { padding:0.2rem 0.4rem; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
<div id="root"></div>

<script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

<script>
function getJsPDF(){
  const g = window.jspdf || window.jsPDF || {};
  return g.jsPDF || g;
}

function exportFerkelbehandlungPdf(rows){
  const jsPDF = getJsPDF();
  if(!jsPDF){ alert("PDF-Bibliothek nicht geladen."); return; }
  const doc = new jsPDF();
  doc.setFontSize(14);
  doc.text("Auswertung Ferkelbehandlungen", 10, 12);
  doc.setFontSize(10);
  let y = 20;
  doc.text("Datum   Sau   Behandlungstyp", 10, y);
  y += 6;
  rows.forEach(function(r){
    if(y > 280){ doc.addPage(); y = 10; }
    const line = (r.datum||"") + "   " + (r.sau||"") + "   " + (r.typ||"");
    doc.text(line, 10, y);
    y += 4;
    if(r.detailsText){
      const txt = "Details: " + r.detailsText;
      const split = doc.splitTextToSize(txt, 180);
      split.forEach(function(part){
        if(y > 280){ doc.addPage(); y = 10; }
        doc.text(part, 12, y);
        y += 4;
      });
    }
    y += 2;
  });
  doc.save("ferkelbehandlungen.pdf");
}

function exportArbeitsplanPdf(rows, fields, sortLabel, von, bis){
  const jsPDF = getJsPDF();
  if(!jsPDF){ alert("PDF-Bibliothek nicht geladen."); return; }
  const doc = new jsPDF("p","mm","a4");
  doc.setFontSize(14);
  doc.text("Tabellarische Liste – Arbeitspläne", 10, 12);
  doc.setFontSize(10);
  doc.text("Zeitraum: " + (von||"-") + " bis " + (bis||"-") + "    Sortierung: " + sortLabel, 10, 18);
  let y = 26;
  const xVom = 10, xBis = 32, xTermin = 54;
  const xNummer = 94, xArt = 122, xStall = 142, xGruppe = 168;
  doc.text("Vom", xVom, y);
  doc.text("Bis", xBis, y);
  doc.text("Termin", xTermin, y);
  if(fields.nummer) doc.text("Nummer", xNummer, y);
  if(fields.art) doc.text("Art", xArt, y);
  if(fields.stallnr) doc.text("Stallnr", xStall, y);
  if(fields.gruppe) doc.text("Gruppe", xGruppe, y);
  y += 6;
  rows.forEach(function(r){
    if(y > 280){ doc.addPage(); y = 10; }
    doc.text(r.vom || "", xVom, y);
    doc.text(r.bis || "", xBis, y);
    doc.text(r.termin || "", xTermin, y);
    if(fields.nummer) doc.text(String(r.nummer||""), xNummer, y);
    if(fields.art) doc.text(r.art || "", xArt, y);
    if(fields.stallnr) doc.text(String(r.stallnr||""), xStall, y);
    if(fields.gruppe) doc.text(r.gruppe || "", xGruppe, y);
    y += 5;
  });
  doc.save("arbeitsplan_tabellarische_liste.pdf");
}

const { useState, useMemo } = React;
const ART = { SAU: "Sau", EBER: "Eber" };
const STATUS = { TRAGEND: "Tragend", SAEUGEND: "Säugend", GUEST: "Güst" };
const FIX_EBER_NAME = "E-1";

function uid(){ return Math.random().toString(36).slice(2,9); }
function today(){ return new Date().toISOString().slice(0,10); }
function addDaysStr(d, days){
  const dt = new Date(d);
  dt.setDate(dt.getDate()+days);
  return dt.toISOString().slice(0,10);
}

function initialAnimals(){
  const list = [];
  list.push({
    id:uid(),
    art:ART.EBER,
    nummer:FIX_EBER_NAME,
    gruppe:"Eber",
    stallnr:"1",
    rasse:"Pi",
    geburtsdatum:"2024-01-01",
    abgangsdatum:null,
    status:STATUS.GUEST,
    ohrmarke:"E-1",
    taetowierung:"",
    bemerkungen:"Deck-Eber",
    zugang:{datum:"2024-01-15",gewicht:"220",preis:"0",grund:"Eigenbetrieb",lieferant:""},
    abgang:null,
    statusIgnorieren:false,
    bewegungen:{ zukauf:[], belegungen:[], traechPruefungen:[], stallwechsel:[], ferkelungen:[], ferkelBehandlungen:[], absetzungen:[] }
  });
  for(let i=0;i<8;i++){
    list.push({
      id:uid(),
      art:ART.SAU,
      nummer:String(1000+i),
      gruppe:"Zuchtsau",
      stallnr:String(1+(i%5)),
      rasse:"F1",
      geburtsdatum:new Date(2023,(i%12),1+(i%20)).toISOString().slice(0,10),
      abgangsdatum:null,
      status:STATUS.GUEST,
      ohrmarke:String(300+i),
      taetowierung:"",
      bemerkungen:"Demo-Sau",
      zugang:{datum:"2024-08-15",gewicht:"140",preis:"300",grund:"Zukauf",lieferant:"Burstaller"},
      abgang:null,
      statusIgnorieren:false,
      bewegungen:{ zukauf:[], belegungen:[], traechPruefungen:[], stallwechsel:[], ferkelungen:[], ferkelBehandlungen:[], absetzungen:[] }
    });
  }
  const sau = list.find(t=>t.art===ART.SAU);
  if(sau){
    const beleg = today();
    sau.bewegungen.belegungen.push({datum:beleg, anzahl:1, art:"Natursprung", eberName:FIX_EBER_NAME, eberNr:FIX_EBER_NAME});
    const ferk = addDaysStr(beleg,115);
    sau.bewegungen.ferkelungen.push({datum:ferk, lebend:12, tot:0, mumifiziert:0});
    const abs = addDaysStr(ferk,28);
    sau.bewegungen.absetzungen.push({datum:abs, anzahl:12});
  }
  return list;
}

function latestRefDate(t, bezug){
  const b = t.bewegungen;
  const pickLast=(arr,key)=>arr && arr.length? new Date(arr[arr.length-1][key]):null;
  if(bezug==="Absetzen") return pickLast(b.absetzungen,"datum");
  if(bezug==="Belegung") return pickLast(b.belegungen,"datum");
  if(bezug==="Ferkelung") return pickLast(b.ferkelungen,"datum");
  return null;
}

function App(){
  const [tiere,setTiere] = useState(initialAnimals());
  const [markiert,setMarkiert] = useState([]);
  const [tab,setTab] = useState("bewegungen");
  const [filter,setFilter] = useState({art:"alle", bestand:"alle"});
  const [search,setSearch] = useState("");

  const emptyAnimalForm = {
    art:"Sau",
    nummer:"",
    gruppe:"Zuchtsau",
    stallnr:"1",
    ohrmarke:"",
    taetowierung:"",
    geburtsdatum:today(),
    rasse:"F1",
    bemerkungen:"",
    zugangsdatum:today(),
    zugangsgewicht:"",
    einkaufspreis:"",
    zugangsgrund:"",
    lieferant:"",
    abgangsdatum:"",
    abgangsgewicht:"",
    verkaufspreis:"",
    abgangsgrund:"",
    abnehmer:"",
    statusIgnorieren:false
  };
  const [animalDialog,setAnimalDialog] = useState({open:false,mode:"new",tier:null});
  const [animalForm,setAnimalForm] = useState(emptyAnimalForm);

  const gefiltert = useMemo(()=>tiere.filter(t=>{
    if(filter.art!=="alle" && t.art!==filter.art) return false;
    if(filter.bestand==="imBestand" && t.abgangsdatum) return false;
    if(filter.bestand==="abgegangen" && !t.abgangsdatum) return false;
    if(search && !( (t.nummer+" "+t.gruppe+" "+t.stallnr+" "+(t.rasse||"")).toLowerCase().includes(search.toLowerCase()) )) return false;
    return true;
  }),[tiere,filter,search]);

  const stats = useMemo(()=>{
    const byArt={};
    gefiltert.forEach(t=>byArt[t.art]=(byArt[t.art]||0)+1);
    return {anzahl:gefiltert.length,byArt};
  },[gefiltert]);

  function toggleMark(id){
    setMarkiert(m=>m.includes(id)? m.filter(x=>x!==id):[...m,id]);
  }
  function selectAll(){ setMarkiert(gefiltert.map(t=>t.id)); }
  function clearSel(){ setMarkiert([]); }

  function openNewAnimal(){
    setAnimalForm(emptyAnimalForm);
    setAnimalDialog({open:true,mode:"new",tier:null});
  }

  function openEditAnimal(){
    if(markiert.length!==1){
      alert("Bitte genau ein Tier in der Liste markieren.");
      return;
    }
    const tier = tiere.find(t=>t.id===markiert[0]);
    if(!tier) return;
    setAnimalForm({
      art: tier.art===ART.EBER?"Eber":"Sau",
      nummer: tier.nummer||"",
      gruppe: tier.gruppe||"Zuchtsau",
      stallnr: tier.stallnr||"1",
      ohrmarke: tier.ohrmarke||"",
      taetowierung: tier.taetowierung||"",
      geburtsdatum: tier.geburtsdatum||today(),
      rasse: tier.rasse||"F1",
      bemerkungen: tier.bemerkungen||"",
      zugangsdatum: (tier.zugang && tier.zugang.datum) || today(),
      zugangsgewicht: (tier.zugang && tier.zugang.gewicht) || "",
      einkaufspreis: (tier.zugang && tier.zugang.preis) || "",
      zugangsgrund: (tier.zugang && tier.zugang.grund) || "",
      lieferant: (tier.zugang && tier.zugang.lieferant) || "",
      abgangsdatum: (tier.abgang && tier.abgang.datum) || (tier.abgangsdatum||""),
      abgangsgewicht: (tier.abgang && tier.abgang.gewicht) || "",
      verkaufspreis: (tier.abgang && tier.abgang.preis) || "",
      abgangsgrund: (tier.abgang && tier.abgang.grund) || "",
      abnehmer: (tier.abgang && tier.abgang.abnehmer) || "",
      statusIgnorieren: !!tier.statusIgnorieren
    });
    setAnimalDialog({open:true,mode:"edit",tier});
  }

  function deleteAnimals(){
    if(markiert.length===0){
      alert("Keine Tiere markiert.");
      return;
    }
    if(!confirm("Sollen die markierten Tiere wirklich gelöscht werden? ("+markiert.length+" Stück)")) return;
    setTiere(prev=>prev.filter(t=>!markiert.includes(t.id)));
    setMarkiert([]);
  }

  function saveAnimal(){
    if(!animalForm.nummer){
      alert("Bitte eine Tier-/Sau-Nummer eingeben.");
      return;
    }
    if(animalDialog.mode==="new"){
      const neu = {
        id:uid(),
        art: animalForm.art==="Eber"?ART.EBER:ART.SAU,
        nummer: animalForm.nummer,
        gruppe: animalForm.gruppe,
        stallnr: animalForm.stallnr,
        rasse: animalForm.rasse,
        geburtsdatum: animalForm.geburtsdatum,
        abgangsdatum: animalForm.abgangsdatum || null,
        status: STATUS.GUEST,
        ohrmarke: animalForm.ohrmarke,
        taetowierung: animalForm.taetowierung,
        bemerkungen: animalForm.bemerkungen,
        zugang:{datum:animalForm.zugangsdatum,gewicht:animalForm.zugangsgewicht,preis:animalForm.einkaufspreis,grund:animalForm.zugangsgrund,lieferant:animalForm.lieferant},
        abgang: animalForm.abgangsdatum ? {datum:animalForm.abgangsdatum,gewicht:animalForm.abgangsgewicht,preis:animalForm.verkaufspreis,grund:animalForm.abgangsgrund,abnehmer:animalForm.abnehmer} : null,
        statusIgnorieren: animalForm.statusIgnorieren,
        bewegungen:{ zukauf:[], belegungen:[], traechPruefungen:[], stallwechsel:[], ferkelungen:[], ferkelBehandlungen:[], absetzungen:[] }
      };
      setTiere(prev=>[...prev,neu]);
    } else if(animalDialog.mode==="edit" && animalDialog.tier){
      const id = animalDialog.tier.id;
      setTiere(prev=>prev.map(t=>{
        if(t.id!==id) return t;
        return {
          ...t,
          art: animalForm.art==="Eber"?ART.EBER:ART.SAU,
          nummer: animalForm.nummer,
          gruppe: animalForm.gruppe,
          stallnr: animalForm.stallnr,
          rasse: animalForm.rasse,
          geburtsdatum: animalForm.geburtsdatum,
          abgangsdatum: animalForm.abgangsdatum || null,
          ohrmarke: animalForm.ohrmarke,
          taetowierung: animalForm.taetowierung,
          bemerkungen: animalForm.bemerkungen,
          zugang:{datum:animalForm.zugangsdatum,gewicht:animalForm.zugangsgewicht,preis:animalForm.einkaufspreis,grund:animalForm.zugangsgrund,lieferant:animalForm.lieferant},
          abgang: animalForm.abgangsdatum ? {datum:animalForm.abgangsdatum,gewicht:animalForm.abgangsgewicht,preis:animalForm.verkaufspreis,grund:animalForm.abgangsgrund,abnehmer:animalForm.abnehmer} : null,
          statusIgnorieren: animalForm.statusIgnorieren
        };
      }));
    }
    setAnimalDialog({open:false,mode:"new",tier:null});
  }

  const gefiltertMitMark = gefiltert; // nur alias

  function exportJson(){
    const blob = new Blob([JSON.stringify({tiere},null,2)],{type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = "seifisau_export.json"; a.click();
    URL.revokeObjectURL(url);
  }

  return React.createElement("div",{className:"min-h-screen"},
    React.createElement("div",{className:"border-b bg-white"},
      React.createElement("div",{className:"mx-auto max-w-7xl px-4 py-2 flex items-center justify-between text-sm"},
        React.createElement("div",{className:"flex items-center gap-2"},
          React.createElement("div",{className:"w-7 h-7 rounded-full bg-rose-500 text-white flex items-center justify-center text-xs font-bold"},"SS"),
          React.createElement("div",null,
            React.createElement("div",{className:"font-semibold text-base"},"SeifiSau"),
            React.createElement("div",{className:"muted"},"Sauenplaner")
          )
        ),
        React.createElement("div",{className:"flex gap-2"},
          ["Bestand","Eingabe","Auswertung","Verwaltung","Optionen","Hilfe"].map(m =>
            React.createElement("button",{key:m,className:"px-3 py-1.5 rounded-xl hover:bg-slate-100"},m)
          )
        )
      )
    ),
    React.createElement("div",{className:"border-b bg-white/70"},
      React.createElement("div",{className:"mx-auto max-w-7xl px-4 py-3 grid grid-cols-2 md:grid-cols-8 gap-2"},
        ["Neue Tiere","Bewegungen","Infobericht","Buchungen","Arbeitspläne","Bestände","Statistik","Wartezeiten"].map((l) =>
          React.createElement("button",{
              key:l,
              className:"btn w-full",
              onClick:()=>{
                if(l==="Neue Tiere") openNewAnimal();
                if(l==="Bewegungen") setTab("bewegungen");
                if(l==="Arbeitspläne") setTab("arbeitsplan");
                if(l==="Bestände") setTab("bestände");
                if(l==="Statistik") setTab("statistik");
                if(l==="Wartezeiten") setTab("wartezeiten");
              }
            },
            l
          )
        )
      )
    ),
    React.createElement("div",{className:"border-b bg-white"},
      React.createElement("div",{className:"mx-auto max-w-7xl px-4 py-3 flex flex-wrap items-center gap-3"},
        React.createElement("div",{className:"flex items-center gap-2 text-sm"},
          React.createElement("span",null,"Ansicht:"),
          React.createElement("select",{className:"select",value:filter.art,onChange:e=>setFilter({...filter,art:e.target.value})},
            React.createElement("option",{value:"alle"},"Alle Tiere"),
            React.createElement("option",{value:ART.SAU},"Sauen"),
            React.createElement("option",{value:ART.EBER},"Eber")
          ),
          React.createElement("select",{className:"select",value:filter.bestand,onChange:e=>setFilter({...filter,bestand:e.target.value})},
            React.createElement("option",{value:"alle"},"Alles"),
            React.createElement("option",{value:"imBestand"},"Im Bestand"),
            React.createElement("option",{value:"abgegangen"},"Abgegangen")
          )
        ),
        React.createElement("div",{className:"ml-auto flex items-center gap-2"},
          React.createElement("input",{className:"input",placeholder:"Nummer, Gruppe, Stall...",value:search,onChange:e=>setSearch(e.target.value)}),
          React.createElement("button",{className:"btn",onClick:selectAll},"Alle markieren"),
          React.createElement("button",{className:"btn",onClick:clearSel},"Auswahl löschen")
        )
      )
    ),
    React.createElement("div",{className:"mx-auto max-w-7xl p-4 grid grid-cols-1 md:grid-cols-3 gap-4"},
      React.createElement("div",{className:"md:col-span-1 card"},
        React.createElement("div",{className:"card-header flex justify-between items-center"},
          React.createElement("span",null,"Tierliste (",gefiltertMitMark.length,")"),
          React.createElement("div",{className:"flex gap-1"},
            React.createElement("button",{className:"btn",onClick:openNewAnimal},"Neu"),
            React.createElement("button",{className:"btn",onClick:openEditAnimal},"Bearbeiten"),
            React.createElement("button",{className:"btn",onClick:deleteAnimals},"Löschen")
          )
        ),
        React.createElement("div",{className:"card-body space-y-2",style:{maxHeight:"520px",overflow:"auto"}},
          gefiltertMitMark.map(t =>
            React.createElement("button",{key:t.id,onClick:()=>toggleMark(t.id),
              className:"w-full text-left rounded-xl border px-3 py-2 text-xs "+(markiert.includes(t.id)?"border-rose-400 ring-2 ring-rose-200":"border-slate-200 hover:bg-slate-50")},
              React.createElement("div",{className:"flex justify-between text-sm mb-1"},
                React.createElement("span",{style:{fontWeight:600}},t.art+" "+t.nummer),
                React.createElement("span",{style:{color:"#64748b"}},"Stall ",t.stallnr||"-")
              ),
              React.createElement("div",{style:{color:"#64748b"}}, "Gruppe ",t.gruppe||"-"," • Rasse ",t.rasse||"-")
            )
          )
        )
      ),
      React.createElement("div",{className:"md:col-span-2 card"},
        React.createElement("div",{className:"card-header"},"Bewegungsdaten & Auswertungen"),
        React.createElement("div",{className:"card-body"},
          React.createElement("div",{className:"flex gap-2 mb-3"},
            ["bewegungen","arbeitsplan","status","bestände","statistik","wartezeiten"].map(k =>
              React.createElement("div",{key:k,onClick:()=>setTab(k),className:"tab "+(tab===k?"tab-active":"")},k.toUpperCase())
            )
          ),
          tab==="bewegungen" && React.createElement(MovementEntry,{markiert,setTiere}),
          tab==="arbeitsplan" && React.createElement(Arbeitsplan,{tiere:gefiltert}),
          tab==="status" && React.createElement(StatusTabs,{tiere:gefiltert}),
          tab==="bestände" && React.createElement(Bestaende,{tiere:gefiltert}),
          tab==="statistik" && React.createElement(Statistik,{tiere:gefiltert}),
          tab==="wartezeiten" && React.createElement(Wartezeiten,{tiere:gefiltert})
        )
      )
    ),
    React.createElement("div",{className:"sticky bottom-0 bg-white border-t"},
      React.createElement("div",{className:"mx-auto max-w-7xl px-4 py-2 text-sm flex items-center gap-4"},
        React.createElement("div",null,"Bestand gesamt: ",React.createElement("b",null,stats.anzahl)),
        React.createElement("div",{className:"hidden md:flex items-center gap-3",style:{color:"#64748b"}},
          React.createElement("span",null,"Sauen: ",stats.byArt[ART.SAU]||0),
          React.createElement("span",null,"Eber: ",stats.byArt[ART.EBER]||0)
        ),
        React.createElement("div",{className:"ml-auto flex items-center gap-2"},
          React.createElement("button",{className:"btn",onClick:exportJson},"Export")
        )
      )
    ),
    animalDialog.open && React.createElement(AnimalDialog,{
      animalForm,
      setAnimalForm,
      animalDialog,
      onSave: saveAnimal,
      onClose: ()=>setAnimalDialog({open:false,mode:"new",tier:null}),
      tiere
    })
  );
}

function MovementEntry({markiert,setTiere}){
  const [art,setArt] = useState("Belegung");
  const [form,setForm] = useState({ datum:today(), deckart:"Natursprung", eberName:FIX_EBER_NAME, eberNr:FIX_EBER_NAME });
  function setF(key,val){
    setForm(prev=>{
      const next = {...prev,[key]:val};
      if(key==="deckart"){
        if(val==="Natursprung"){
          next.eberName = FIX_EBER_NAME;
          next.eberNr   = FIX_EBER_NAME;
          next.samenStation = "";
        } else if(val==="Besamung"){
          next.eberName = "";
          next.eberNr   = "";
        }
      }
      return next;
    });
  }
  function apply(mut){
    if(markiert.length===0) return;
    setTiere(prev=>prev.map(t=>{
      if(!markiert.includes(t.id)) return t;
      const copy = JSON.parse(JSON.stringify(t));
      mut(copy);
      return copy;
    }));
  }
  function save(){
    if(art==="Zukauf"){
      apply(t=>t.bewegungen.zukauf.push({datum:form.datum, herkunft:form.herkunft||"", statusBeimZukauf:form.statusBeimZukauf||"Jungsau", belegdatum:form.belegdatum||"", eberName:form.eberName||"", eberNr:form.eberNr||"" }));
    }
    if(art==="Belegung"){
      apply(t=>t.bewegungen.belegungen.push({datum:form.datum, anzahl:Number(form.anzahl||1), art:form.deckart||"Natursprung", eberName:form.eberName||"", eberNr:form.eberNr||"", samenStation:form.samenStation||"" }));
    }
    if(art==="Trächtigkeitsprüfung"){
      apply(t=>t.bewegungen.traechPruefungen.push({datum:form.datum, ergebnis:form.ergebnis||"tragend", methode:form.methode||"", kommentar:form.kommentar||"" }));
    }
    if(art==="Stallwechsel"){
      apply(t=>t.bewegungen.stallwechsel.push({datum:form.datum, ziel:form.ziel||"Wartestall"}));
    }
    if(art==="Ferkelung"){
      apply(t=>t.bewegungen.ferkelungen.push({datum:form.datum, lebend:Number(form.lebend||0), tot:Number(form.tot||0), mumifiziert:Number(form.mumifiziert||0)}));
    }
    if(art==="Ferkelbehandlung"){
      apply(t=>t.bewegungen.ferkelBehandlungen.push({datum:form.datum, typ:form.behTyp||"", details:{...form}}));
    }
    if(art==="Absetzen"){
      apply(t=>t.bewegungen.absetzungen.push({datum:form.datum, anzahl:Number(form.anzahlAbgesetzt||0)}));
    }
    setForm(f=>({...f, datum:today()}));
  }
  const natursprung = form.deckart==="Natursprung";
  return React.createElement("div",{className:"grid md:grid-cols-5 gap-4"},
    React.createElement("div",{className:"md:col-span-2"},
      React.createElement("div",{className:"card"},
        React.createElement("div",{className:"card-header"},"Tierauswahl"),
        React.createElement("div",{className:"card-body"},
          React.createElement("div",{style:{marginBottom:"0.4rem",color:"#475569"}},"Markierte Tiere: ",React.createElement("b",null,markiert.length)),
          React.createElement("div",{className:"muted"},"Sammelbuchung: wird auf alle markierten Tiere gespeichert.")
        )
      )
    ),
    React.createElement("div",{className:"md:col-span-3"},
      React.createElement("div",{className:"card"},
        React.createElement("div",{className:"card-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
          React.createElement("span",null,"Bewegungsdatensatz"),
          React.createElement("select",{className:"select",style:{width:"11rem"},value:art,onChange:e=>setArt(e.target.value)},
            ["Zukauf","Belegung","Trächtigkeitsprüfung","Stallwechsel","Ferkelung","Ferkelbehandlung","Absetzen"].map(o =>
              React.createElement("option",{key:o,value:o},o)
            )
          )
        ),
        React.createElement("div",{className:"card-body grid grid-cols-2 gap-3"},
          React.createElement("div",null,
            React.createElement("label",{className:"muted"},"Datum"),
            React.createElement("input",{type:"date",className:"input",value:form.datum||"",onChange:e=>setF("datum",e.target.value)})
          ),
          art==="Belegung" && [
            React.createElement("div",{key:"anz"},
              React.createElement("label",{className:"muted"},"Anzahl Deckungen"),
              React.createElement("input",{type:"number",className:"input",value:form.anzahl||1,onChange:e=>setF("anzahl",e.target.value)})
            ),
            React.createElement("div",{key:"deck"},
              React.createElement("label",{className:"muted"},"Deckart"),
              React.createElement("select",{className:"select",value:form.deckart||"Natursprung",onChange:e=>setF("deckart",e.target.value)},
                React.createElement("option",{value:"Natursprung"},"Natursprung"),
                React.createElement("option",{value:"Besamung"},"Besamung")
              ),
              natursprung && React.createElement("div",{className:"muted",style:{marginTop:"0.2rem"}},"Deckpartner voreingestellt: Eber ",FIX_EBER_NAME)
            ),
            React.createElement("div",{key:"eber",className:"col-span-2"},
              React.createElement("label",{className:"muted"},"Eber (Name/Nr.) oder Samen-Station"),
              React.createElement("input",{className:"input",style:{marginBottom:"0.25rem"},placeholder:"Ebername",value:form.eberName||"",onChange:e=>setF("eberName",e.target.value),disabled:natursprung}),
              React.createElement("div",{className:"grid grid-cols-2 gap-2"},
                React.createElement("input",{className:"input",placeholder:"Eber-Nr.",value:form.eberNr||"",onChange:e=>setF("eberNr",e.target.value),disabled:natursprung}),
                React.createElement("input",{className:"input",placeholder:"Samen-Station",value:form.samenStation||"",onChange:e=>setF("samenStation",e.target.value),disabled:natursprung})
              )
            )
          ],
          art==="Zukauf" && [
            React.createElement("div",{key:"herk"},
              React.createElement("label",{className:"muted"},"Herkunft/Züchter"),
              React.createElement("input",{className:"input",value:form.herkunft||"",onChange:e=>setF("herkunft",e.target.value)})
            ),
            React.createElement("div",{key:"stat"},
              React.createElement("label",{className:"muted"},"Status beim Zukauf"),
              React.createElement("select",{className:"select",value:form.statusBeimZukauf||"Jungsau",onChange:e=>setF("statusBeimZukauf",e.target.value)},
                React.createElement("option",{value:"Jungsau"},"Jungsau (ungedeckt)"),
                React.createElement("option",{value:"trächtig"},"Trächtig (gedeckt)")
              )
            ),
            React.createElement("div",{key:"bez"},
              React.createElement("label",{className:"muted"},"Belegdatum (falls trächtig)"),
              React.createElement("input",{type:"date",className:"input",value:form.belegdatum||"",onChange:e=>setF("belegdatum",e.target.value)})
            ),
            React.createElement("div",{key:"zkeber"},
              React.createElement("label",{className:"muted"},"Eber Name / Nr. (optional)"),
              React.createElement("input",{className:"input",style:{marginBottom:"0.25rem"},placeholder:"Name",value:form.eberName||"",onChange:e=>setF("eberName",e.target.value)}),
              React.createElement("input",{className:"input",placeholder:"Nummer",value:form.eberNr||"",onChange:e=>setF("eberNr",e.target.value)})
            )
          ],
          art==="Trächtigkeitsprüfung" && [
            React.createElement("div",{key:"erg"},
              React.createElement("label",{className:"muted"},"Ergebnis"),
              React.createElement("select",{className:"select",value:form.ergebnis||"tragend",onChange:e=>setF("ergebnis",e.target.value)},
                React.createElement("option",{value:"tragend"},"Tragend"),
                React.createElement("option",{value:"nicht tragend"},"Nicht tragend")
              )
            ),
            React.createElement("div",{key:"meth"},
              React.createElement("label",{className:"muted"},"Methode"),
              React.createElement("input",{className:"input",placeholder:"z. B. Ultraschall",value:form.methode||"",onChange:e=>setF("methode",e.target.value)})
            ),
            React.createElement("div",{key:"komm",className:"col-span-2"},
              React.createElement("label",{className:"muted"},"Kommentar"),
              React.createElement("input",{className:"input",placeholder:"Optional",value:form.kommentar||"",onChange:e=>setF("kommentar",e.target.value)})
            )
          ],
          art==="Stallwechsel" && React.createElement("div",{className:"col-span-2"},
            React.createElement("label",{className:"muted"},"Zielstall"),
            React.createElement("select",{className:"select",value:form.ziel||"Wartestall",onChange:e=>setF("ziel",e.target.value)},
              React.createElement("option",{value:"Deckzentrum"},"Deckzentrum"),
              React.createElement("option",{value:"Wartestall"},"Wartestall"),
              React.createElement("option",{value:"Abferkelstall"},"Abferkelstall")
            )
          ),
          art==="Ferkelung" && [
            React.createElement("div",{key:"leb"},
              React.createElement("label",{className:"muted"},"Ferkel lebend"),
              React.createElement("input",{type:"number",className:"input",value:form.lebend||0,onChange:e=>setF("lebend",e.target.value)})
            ),
            React.createElement("div",{key:"tot"},
              React.createElement("label",{className:"muted"},"Ferkel totgeboren"),
              React.createElement("input",{type:"number",className:"input",value:form.tot||0,onChange:e=>setF("tot",e.target.value)})
            ),
            React.createElement("div",{key:"mum"},
              React.createElement("label",{className:"muted"},"Mumifiziert"),
              React.createElement("input",{type:"number",className:"input",value:form.mumifiziert||0,onChange:e=>setF("mumifiziert",e.target.value)})
            )
          ],
          art==="Ferkelbehandlung" && [
            React.createElement("div",{key:"typ",className:"col-span-2"},
              React.createElement("label",{className:"muted"},"Behandlungstyp (frei eingeben)"),
              React.createElement("input",{className:"input",placeholder:"z. B. Tag 1 Naxcel + Kupieren, Eisen, Circo, Draxxin, Kastration ...",value:form.behTyp||"",onChange:e=>setF("behTyp",e.target.value)})
            ),
            React.createElement("div",{key:"det",className:"col-span-2"},
              React.createElement("label",{className:"muted"},"Details / Präparat / Los / Menge"),
              React.createElement("input",{className:"input",placeholder:"z. B. Präparat, Dosis, Bemerkungen",value:form.details||"",onChange:e=>setF("details",e.target.value)})
            )
          ],
          art==="Absetzen" && React.createElement("div",{className:"col-span-2"},
            React.createElement("label",{className:"muted"},"Abgesetzte Ferkel"),
            React.createElement("input",{type:"number",className:"input",value:form.anzahlAbgesetzt||0,onChange:e=>setF("anzahlAbgesetzt",e.target.value)})
          ),
          React.createElement("div",{className:"col-span-2"},
            React.createElement("label",{className:"muted"},"Kommentar"),
            React.createElement("input",{className:"input",placeholder:"Optional",value:form.kommentar||"",onChange:e=>setF("kommentar",e.target.value)})
          ),
          React.createElement("div",{className:"col-span-2 flex gap-2 mt-1"},
            React.createElement("button",{className:"btn",onClick:save},"Speichern"),
            React.createElement("button",{className:"btn"},"OK + Nächster"),
            React.createElement("button",{className:"btn"},"Löschen")
          )
        )
      )
    )
  );
}

function Arbeitsplan({tiere}){
  const PLAENE = [
    {key:"Absetzung", bezug:"Ferkelung", von:28, bis:30},
    {key:"Belegung", bezug:"Absetzen", von:5, bis:7},
    {key:"Ferkelung", bezug:"Belegung", von:115, bis:118},
    {key:"Trächtigkeitskontr.", bezug:"Belegung", von:21, bis:24}
  ];
  const [von,setVon] = useState(today());
  const [wochen,setWochen] = useState(1);
  const [bis,setBis] = useState(addDaysStr(today(),7*1-1));
  const [selPlaene,setSelPlaene] = useState(()=>{ const obj={}; PLAENE.forEach(p=>obj[p.key]=true); return obj; });
  const [felder,setFelder] = useState({nummer:true, art:false, stallnr:false, gruppe:true});
  const [sort,setSort] = useState("nummer");
  const [nurSauen,setNurSauen] = useState(true);
  const [wartezeit,setWartezeit] = useState(false);
  function updateBis(newVon,newWo){ setBis(addDaysStr(newVon, newWo*7-1)); }
  function onVonChange(v){ setVon(v); updateBis(v,wochen); }
  function setWeeks(w){ setWochen(w); updateBis(von,w); }
  function setAllPlaene(val){ const obj={}; PLAENE.forEach(p=>obj[p.key]=val); setSelPlaene(obj); }
  const termine = useMemo(()=>{
    if(!von || !bis) return [];
    const vonDt = new Date(von);
    const bisDt = new Date(bis);
    const rows = [];
    tiere.forEach(t=>{
      if(nurSauen && t.art!==ART.SAU) return;
      PLAENE.forEach(p=>{
        if(!selPlaene[p.key]) return;
        const ref = latestRefDate(t,p.bezug);
        if(!ref) return;
        const vomDt = new Date(ref.getTime()+p.von*86400000);
        const bisTermDt = new Date(ref.getTime()+p.bis*86400000);
        if(bisTermDt < vonDt || vomDt > bisDt) return;
        rows.push({
          vom: vomDt.toISOString().slice(0,10),
          bis: bisTermDt.toISOString().slice(0,10),
          termin: p.key,
          nummer: t.nummer,
          art: t.art,
          stallnr: t.stallnr,
          gruppe: t.gruppe
        });
      });
    });
    function cmp(x,y){ if(x<y) return -1; if(x>y) return 1; return 0; }
    rows.sort((a,b)=>{
      const nA = parseInt(a.nummer,10); const nB = parseInt(b.nummer,10);
      const numCmp = isNaN(nA)||isNaN(nB) ? cmp(a.nummer,b.nummer) : cmp(nA,nB);
      const stallA = parseInt(a.stallnr,10); const stallB = parseInt(b.stallnr,10);
      if(sort==="nummer") return numCmp || cmp(a.gruppe,b.gruppe);
      if(sort==="art_nummer") return cmp(a.art,b.art) || numCmp;
      if(sort==="stallnr_nummer") return (isNaN(stallA)||isNaN(stallB)?cmp(a.stallnr,b.stallnr):cmp(stallA,stallB)) || numCmp;
      if(sort==="gruppe_nummer") return cmp(a.gruppe,b.gruppe) || numCmp;
      return numCmp;
    });
    return rows;
  },[tiere,von,bis,selPlaene,sort,nurSauen]);
  const sortLabelMap = {nummer:"Nummer",art_nummer:"Art und Nummer",stallnr_nummer:"Stallnr und Nummer",gruppe_nummer:"Gruppe und Nummer"};
  const vorschau = termine.slice(0,40);
  return React.createElement("div",{className:"grid md:grid-cols-5 gap-4"},
    React.createElement("div",{className:"md:col-span-2 card"},
      React.createElement("div",{className:"card-header"},"Arbeitspläne berechnen"),
      React.createElement("div",{className:"card-body text-xs space-y-3"},
        React.createElement("div",null,
          React.createElement("div",{className:"mb-1",style:{fontWeight:600}},"Arbeitspläne"),
          React.createElement("div",{className:"border rounded-lg h-32 overflow-auto bg-white"},
            PLAENE.map(p=>
              React.createElement("label",{key:p.key,style:{display:"block",padding:"2px 6px"}},
                React.createElement("input",{type:"checkbox",className:"mr-1",checked:!!selPlaene[p.key],onChange:e=>setSelPlaene({...selPlaene,[p.key]:e.target.checked})}),
                p.key
              )
            )
          ),
          React.createElement("div",{className:"mt-1 flex gap-2"},
            React.createElement("button",{className:"btn",onClick:()=>setAllPlaene(true)},"Alle"),
            React.createElement("button",{className:"btn",onClick:()=>setAllPlaene(false)},"Keine")
          )
        ),
        React.createElement("div",{className:"border-t pt-2 mt-2"},
          React.createElement("div",{className:"mb-1",style:{fontWeight:600}},"Termine berechnen"),
          React.createElement("div",{className:"flex items-center gap-2 mb-2"},
            React.createElement("span",{className:"muted"},"Berechnungszeitraum ab..."),
            React.createElement("input",{type:"date",className:"input",style:{maxWidth:"130px"},value:von,onChange:e=>onVonChange(e.target.value)}),
            React.createElement("span",{className:"muted"},"bis"),
            React.createElement("input",{type:"date",className:"input",style:{maxWidth:"130px"},value:bis,onChange:e=>setBis(e.target.value)})
          ),
          React.createElement("div",{className:"flex gap-2 mb-2"},
            [1,2,3,4].map(w=>React.createElement("button",{key:w,className:"btn",onClick:()=>setWeeks(w)},w+" Wochen"))
          )
        ),
        React.createElement("div",{className:"border-t pt-2 mt-2 grid grid-cols-2 gap-2"},
          React.createElement("div",null,
            React.createElement("div",{className:"mb-1",style:{fontWeight:600}},"Zu listende Datenfelder"),
            ["nummer","art","stallnr","gruppe"].map(k=>
              React.createElement("label",{key:k,style:{display:"block"}},
                React.createElement("input",{type:"checkbox",className:"mr-1",checked:felder[k],onChange:e=>setFelder({...felder,[k]:e.target.checked})}),
                k==="nummer"?"Nummer":k==="art"?"Art":k==="stallnr"?"Stallnr":"Gruppe"
              )
            )
          ),
          React.createElement("div",null,
            React.createElement("div",{className:"mb-1",style:{fontWeight:600}},"Sortierung nach..."),
            React.createElement("label",{style:{display:"block"}},
              React.createElement("input",{type:"radio",name:"sort",className:"mr-1",checked:sort==="nummer",onChange:()=>setSort("nummer")}),
              "Nummer"
            ),
            React.createElement("label",{style:{display:"block"}},
              React.createElement("input",{type:"radio",name:"sort",className:"mr-1",checked:sort==="art_nummer",onChange:()=>setSort("art_nummer")}),
              "Art und Nummer"
            ),
            React.createElement("label",{style:{display:"block"}},
              React.createElement("input",{type:"radio",name:"sort",className:"mr-1",checked:sort==="stallnr_nummer",onChange:()=>setSort("stallnr_nummer")}),
              "Stallnr und Nummer"
            ),
            React.createElement("label",{style:{display:"block"}},
              React.createElement("input",{type:"radio",name:"sort",className:"mr-1",checked:sort==="gruppe_nummer",onChange:()=>setSort("gruppe_nummer")}),
              "Gruppe und Nummer"
            )
          )
        ),
        React.createElement("div",{className:"border-t pt-2 mt-2 space-y-1"},
          React.createElement("label",null,
            React.createElement("input",{type:"checkbox",className:"mr-1",checked:nurSauen,onChange:e=>setNurSauen(e.target.checked)}),
            "Nur Sauen berücksichtigen"
          ),
          React.createElement("label",null,
            React.createElement("input",{type:"checkbox",className:"mr-1",checked:wartezeit,onChange:e=>setWartezeit(e.target.checked)}),
            "Wartezeit (Fleischverkauf) listen"
          ),
          React.createElement("div",{className:"muted mt-1"},"X = Anzeige bei vorhandenem Termin (nur tabellarische Liste)"),
          React.createElement("div",{className:"muted"},"= Anzeige bei freiem Termin (nur tabellarische Liste)")
        ),
        React.createElement("div",{className:"border-t pt-2 mt-3 flex flex-wrap gap-2"},
          React.createElement("button",{className:"btn"},"Arbeitsplan-Optionen"),
          React.createElement("button",{className:"btn"},"Hilfe"),
          React.createElement("button",{className:"btn",onClick:()=>exportArbeitsplanPdf(termine,felder,sortLabelMap[sort],von,bis)},"Tabellarische Liste"),
          React.createElement("button",{className:"btn"},"Schließen")
        )
      )
    ),
    React.createElement("div",{className:"md:col-span-3 card"},
      React.createElement("div",{className:"card-header"},"Tabellarische Liste – Vorschau"),
      React.createElement("div",{className:"card-body",style:{overflow:"auto"}},
        termine.length===0 ? React.createElement("div",{className:"muted"},"Keine Termine im gewählten Zeitraum.") :
        React.createElement("table",{className:"min-w-full text-xs"},
          React.createElement("thead",null,
            React.createElement("tr",{style:{textAlign:"left"}},
              React.createElement("th",null,"Vom"),
              React.createElement("th",null,"Bis"),
              React.createElement("th",null,"Termin"),
              felder.nummer && React.createElement("th",null,"Nummer"),
              felder.art && React.createElement("th",null,"Art"),
              felder.stallnr && React.createElement("th",null,"Stallnr"),
              felder.gruppe && React.createElement("th",null,"Gruppe")
            )
          ),
          React.createElement("tbody",null,
            vorschau.map((r,i)=>React.createElement("tr",{key:i,style:{borderTop:"1px solid #e2e8f0"}},
              React.createElement("td",null,r.vom),
              React.createElement("td",null,r.bis),
              React.createElement("td",null,r.termin),
              felder.nummer && React.createElement("td",null,r.nummer),
              felder.art && React.createElement("td",null,r.art),
              felder.stallnr && React.createElement("td",null,r.stallnr),
              felder.gruppe && React.createElement("td",null,r.gruppe)
            ))
          )
        )
      )
    )
  );
}

function StatusTabs({tiere}){
  const [reg,setReg] = useState("TRAGEND");
  const map = {TRAGEND:"Tragend",SAEUGEND:"Säugend",GUEST:"Güst"};
  const list = tiere.filter(t=>t.status===map[reg]);
  return React.createElement("div",null,
    React.createElement("div",{className:"flex gap-2 mb-3"},
      ["TRAGEND","SAEUGEND","GUEST"].map(k=>
        React.createElement("div",{key:k,onClick:()=>setReg(k),className:"tab "+(reg===k?"tab-active":"")},k)
      )
    ),
    React.createElement("div",{className:"card"},
      React.createElement("div",{className:"card-header"},"Status: ",map[reg]),
      React.createElement("div",{className:"card-body",style:{overflow:"auto"}},
        React.createElement("table",{className:"min-w-full text-xs"},
          React.createElement("thead",null,
            React.createElement("tr",{style:{textAlign:"left"}},
              ["Nummer","Gruppe","Stall","Wurfnr","Letzte Ereignisse","Tage bis Termin"].map(h=>React.createElement("th",{key:h},h))
            )
          ),
          React.createElement("tbody",null,
            list.map(t=>React.createElement("tr",{key:t.id,style:{borderTop:"1px solid #e2e8f0"}},
              React.createElement("td",null,t.nummer),
              React.createElement("td",null,t.gruppe),
              React.createElement("td",null,t.stallnr),
              React.createElement("td",null,Math.floor(Math.random()*6)+1),
              React.createElement("td",null,"—"),
              React.createElement("td",null,Math.floor(Math.random()*30))
            ))
          )
        )
      )
    )
  );
}

function Bestaende({tiere}){
  function group(arr,getKey){ const r={}; arr.forEach(t=>{const k=getKey(t); r[k]=(r[k]||0)+1;}); return r; }
  const nachArt = group(tiere,t=>t.art);
  const nachGruppe = group(tiere,t=>t.gruppe);
  const nachStall = group(tiere,t=>t.stallnr);
  return React.createElement("div",{className:"grid md:grid-cols-2 gap-4"},
    React.createElement("div",{className:"card"},
      React.createElement("div",{className:"card-header"},"Zu listende Datenfelder"),
      React.createElement("div",{className:"card-body space-y-2"},
        ["Art","Nummer","Stallnummer","Alter (Jahre)"].map(x=>React.createElement("div",{key:x},React.createElement("span",{className:"chip"},x))),
        React.createElement("div",null,
          React.createElement("button",{className:"btn"},"Listen"),
          React.createElement("button",{className:"btn",style:{marginLeft:"0.5rem"}},"Gesamtübersicht Stückzahlen")
        )
      )
    ),
    React.createElement("div",{className:"card"},
      React.createElement("div",{className:"card-header"},"Stückzahlen (aktuelle Auswahl)"),
      React.createElement("div",{className:"card-body grid grid-cols-3 gap-3 text-xs"},
        React.createElement("div",null,
          React.createElement("div",{className:"muted"},"nach Art"),
          Object.entries(nachArt).map(([k,v])=>React.createElement("div",{key:k,style:{display:"flex",justifyContent:"space-between"}},React.createElement("span",null,k),React.createElement("b",null,v)))
        ),
        React.createElement("div",null,
          React.createElement("div",{className:"muted"},"nach Gruppe"),
          Object.entries(nachGruppe).map(([k,v])=>React.createElement("div",{key:k,style:{display:"flex",justifyContent:"space-between"}},React.createElement("span",null,k),React.createElement("b",null,v)))
        ),
        React.createElement("div",null,
          React.createElement("div",{className:"muted"},"nach Stall"),
          Object.entries(nachStall).map(([k,v])=>React.createElement("div",{key:k,style:{display:"flex",justifyContent:"space-between"}},React.createElement("span",null,"#",k),React.createElement("b",null,v)))
        )
      )
    )
  );
}

function Statistik({tiere}){
  const sauen = tiere.filter(t=>t.art===ART.SAU);
  const felder = [
    {label:"Ø Tragdauer (Tage)", value:115},
    {label:"Ø Säugedauer (Tage)", value:28},
    {label:"Ø Güstdauer (Tage)", value:7},
    {label:"Ø Ferkel je Wurf", value:12.4},
    {label:"Sauen gesamt", value:sauen.length}
  ];
  const eintraege = [];
  tiere.forEach(function(t){
    (t.bewegungen.ferkelBehandlungen || []).forEach(function(b){
      eintraege.push({sau:t.nummer,datum:b.datum,typ:b.typ,detailsText:b.details && b.details.details ? b.details.details : ""});
    });
  });
  const erste = eintraege.slice(0,10);
  return React.createElement("div",{className:"grid md:grid-cols-2 gap-4"},
    React.createElement("div",{className:"card"},
      React.createElement("div",{className:"card-header"},"Kennzahlen (Demo)"),
      React.createElement("div",{className:"card-body grid grid-cols-2 gap-3 text-xs"},
        felder.map(f=>React.createElement("div",{key:f.label,className:"card",style:{padding:"0.5rem"}},
          React.createElement("div",{className:"muted"},f.label),
          React.createElement("div",{style:{fontWeight:600,fontSize:"1.1rem"}}, typeof f.value==="number"?f.value.toFixed(2):f.value)
        ))
      )
    ),
    React.createElement("div",{className:"card"},
      React.createElement("div",{className:"card-header flex justify-between items-center"},
        React.createElement("span",null,"Ferkelbehandlungen – Auswertung"),
        React.createElement("button",{className:"btn",onClick:()=>exportFerkelbehandlungPdf(eintraege)},"Als PDF exportieren")
      ),
      React.createElement("div",{className:"card-body text-xs space-y-2"},
        eintraege.length===0 ? React.createElement("div",{className:"muted"},"Noch keine Ferkelbehandlungen erfasst.") :
        React.createElement("div",null,
          React.createElement("div",{className:"muted mb-1"},"Vorschau (erste ",erste.length," Einträge)"),
          React.createElement("table",{className:"min-w-full text-[11px]"},
            React.createElement("thead",null,
              React.createElement("tr",{style:{textAlign:"left"}},
                ["Datum","Sau","Typ","Details"].map(h=>React.createElement("th",{key:h},h))
              )
            ),
            React.createElement("tbody",null,
              erste.map((r,idx)=>React.createElement("tr",{key:idx,style:{borderTop:"1px solid #e2e8f0"}},
                React.createElement("td",null,r.datum||""),
                React.createElement("td",null,r.sau||""),
                React.createElement("td",null,r.typ||""),
                React.createElement("td",null,r.detailsText||"")
              ))
            )
          )
        )
      )
    )
  );
}

function Wartezeiten({tiere}){
  function plusTage(d){ const x=new Date(); x.setDate(x.getDate()+d); return x; }
  const list = tiere.filter(t=>t.art===ART.SAU).filter((_,i)=>i%5===0).map(t=>{
    const d = 10 + (t.id.charCodeAt(0)%20);
    const until = plusTage(d);
    return { tier:t.art+" "+t.nummer, sperreBis:until.toISOString().slice(0,10), tage:d };
  });
  return React.createElement("div",{className:"card"},
    React.createElement("div",{className:"card-header"},"Wartezeiten (Sperre bis)"),
    React.createElement("div",{className:"card-body"},
      list.length===0 ? React.createElement("div",{className:"muted"},"Zur Zeit keine Wartezeiten.") :
      React.createElement("table",{className:"min-w-full text-xs"},
        React.createElement("thead",null,
          React.createElement("tr",{style:{textAlign:"left"}},
            ["Tier","Sperre bis","Tage"].map(h=>React.createElement("th",{key:h},h))
          )
        ),
        React.createElement("tbody",null,
          list.map((r,i)=>React.createElement("tr",{key:i,style:{borderTop:"1px solid #e2e8f0"}},
            React.createElement("td",null,r.tier),
            React.createElement("td",null,r.sperreBis),
            React.createElement("td",null,r.tage)
          ))
        )
      )
    )
  );
}

function AnimalDialog(props){
  const {animalForm,setAnimalForm,animalDialog,onSave,onClose,tiere} = props;
  function setF(key,val){ setAnimalForm(prev=>({...prev,[key]:val})); }
  const t = animalDialog.tier;
  const mov = t && t.bewegungen ? t.bewegungen : {belegungen:[],ferkelungen:[],absetzungen:[],traechPruefungen:[]};
  const anzahlBeleg = (mov.belegungen||[]).length;
  const anzahlFerkelungen = (mov.ferkelungen||[]).length;
  let ferkelGesamt = 0, ferkelLebend=0;
  (mov.ferkelungen||[]).forEach(f=>{ ferkelGesamt += (f.lebend||0)+(f.tot||0); ferkelLebend += (f.lebend||0); });
  const letzte = arr => (arr && arr.length ? arr[arr.length-1].datum : "");
  const letzteBelegung = letzte(mov.belegungen);
  const letzteFerkelung = letzte(mov.ferkelungen);
  const letzteTraecht = letzte(mov.traechPruefungen);
  const letzteAbsetzung = letzte(mov.absetzungen);
  return React.createElement("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50"},
    React.createElement("div",{className:"bg-[#fffbe6] rounded-xl shadow-2xl max-w-5xl w-full mx-4"},
      React.createElement("div",{className:"px-4 py-2 border-b flex justify-between items-center bg-amber-100 rounded-t-xl"},
        React.createElement("div",{className:"font-semibold text-sm"},"Schweine (Sauen/Eber) eingeben / ändern – ",animalDialog.mode==="new"?"Neuanlage":"Bearbeiten"),
        React.createElement("button",{className:"btn",onClick:onClose},"X")
      ),
      React.createElement("div",{className:"p-4 grid grid-cols-1 md:grid-cols-3 gap-3 text-xs"},
        React.createElement("div",{className:"md:col-span-2 space-y-3"},
          React.createElement("div",{className:"border border-amber-300 rounded-lg p-2 bg-amber-50"},
            React.createElement("div",{className:"font-semibold mb-1 text-[11px]"},"Tierdaten"),
            React.createElement("div",{className:"grid grid-cols-2 gap-2"},
              React.createElement("div",null,
                React.createElement("label",{className:"muted"},"Art"),
                React.createElement("select",{className:"select",value:animalForm.art,onChange:e=>setF("art",e.target.value)},
                  React.createElement("option",{value:"Sau"},"Sau"),
                  React.createElement("option",{value:"Eber"},"Eber")
                )
              ),
              React.createElement("div",null,
                React.createElement("label",{className:"muted"},"Sau-/Tiernummer"),
                React.createElement("input",{className:"input",value:animalForm.nummer,onChange:e=>setF("nummer",e.target.value)})
              ),
              React.createElement("div",null,
                React.createElement("label",{className:"muted"},"Gruppe"),
                React.createElement("select",{className:"select",value:animalForm.gruppe,onChange:e=>setF("gruppe",e.target.value)},
                  React.createElement("option",{value:"Zuchtsau"},"Zuchtsau"),
                  React.createElement("option",{value:"Jungsau"},"Jungsau"),
                  React.createElement("option",{value:"Eber"},"Eber")
                )
              ),
              React.createElement("div",null,
                React.createElement("label",{className:"muted"},"Stallnr / Box"),
                React.createElement("input",{className:"input",value:animalForm.stallnr,onChange:e=>setF("stallnr",e.target.value)})
              ),
              React.createElement("div",null,
                React.createElement("label",{className:"muted"},"Ohrmarke"),
                React.createElement("input",{className:"input",value:animalForm.ohrmarke,onChange:e=>setF("ohrmarke",e.target.value)})
              ),
              React.createElement("div",null,
                React.createElement("label",{className:"muted"},"Tätowierung-Nr."),
                React.createElement("input",{className:"input",value:animalForm.taetowierung,onChange:e=>setF("taetowierung",e.target.value)})
              ),
              React.createElement("div",null,
                React.createElement("label",{className:"muted"},"Geburtsdatum"),
                React.createElement("input",{type:"date",className:"input",value:animalForm.geburtsdatum,onChange:e=>setF("geburtsdatum",e.target.value)})
              ),
              React.createElement("div",null,
                React.createElement("label",{className:"muted"},"Rasse"),
                React.createElement("input",{className:"input",value:animalForm.rasse,onChange:e=>setF("rasse",e.target.value)})
              ),
              React.createElement("div",{className:"col-span-2"},
                React.createElement("label",{className:"muted"},"Bemerkungen"),
                React.createElement("input",{className:"input",value:animalForm.bemerkungen,onChange:e=>setF("bemerkungen",e.target.value)})
              ),
              React.createElement("div",{className:"col-span-2 flex items-center gap-2 mt-1"},
                React.createElement("input",{type:"checkbox",checked:animalForm.statusIgnorieren,onChange:e=>setF("statusIgnorieren",e.target.checked)}),
                React.createElement("span",{className:"muted"},"Status ignorieren (nur aktivieren, wenn Sau nicht mehr belegt wird)")
              )
            )
          ),
          React.createElement("div",{className:"grid grid-cols-2 gap-3"},
            React.createElement("div",{className:"border border-amber-300 rounded-lg p-2 bg-amber-50"},
              React.createElement("div",{className:"font-semibold mb-1 text-[11px]"},"Zugangsdaten"),
              React.createElement("div",{className:"space-y-1"},
                React.createElement("div",null,
                  React.createElement("label",{className:"muted"},"Zugangsdatum"),
                  React.createElement("input",{type:"date",className:"input",value:animalForm.zugangsdatum,onChange:e=>setF("zugangsdatum",e.target.value)})
                ),
                React.createElement("div",null,
                  React.createElement("label",{className:"muted"},"Zugangsgewicht (kg)"),
                  React.createElement("input",{type:"number",className:"input",value:animalForm.zugangsgewicht,onChange:e=>setF("zugangsgewicht",e.target.value)})
                ),
                React.createElement("div",null,
                  React.createElement("label",{className:"muted"},"Einkaufspreis (€)"),
                  React.createElement("input",{type:"number",className:"input",value:animalForm.einkaufspreis,onChange:e=>setF("einkaufspreis",e.target.value)})
                ),
                React.createElement("div",null,
                  React.createElement("label",{className:"muted"},"Zugangsgrund"),
                  React.createElement("input",{className:"input",value:animalForm.zugangsgrund,onChange:e=>setF("zugangsgrund",e.target.value)})
                ),
                React.createElement("div",null,
                  React.createElement("label",{className:"muted"},"Lieferant"),
                  React.createElement("input",{className:"input",value:animalForm.lieferant,onChange:e=>setF("lieferant",e.target.value)})
                )
              )
            ),
            React.createElement("div",{className:"border border-amber-300 rounded-lg p-2 bg-amber-50"},
              React.createElement("div",{className:"font-semibold mb-1 text-[11px]"},"Abgangsdaten"),
              React.createElement("div",{className:"space-y-1"},
                React.createElement("div",null,
                  React.createElement("label",{className:"muted"},"Abgangsdatum"),
                  React.createElement("input",{type:"date",className:"input",value:animalForm.abgangsdatum,onChange:e=>setF("abgangsdatum",e.target.value)})
                ),
                React.createElement("div",null,
                  React.createElement("label",{className:"muted"},"Abgangsgewicht (kg)"),
                  React.createElement("input",{type:"number",className:"input",value:animalForm.abgangsgewicht,onChange:e=>setF("abgangsgewicht",e.target.value)})
                ),
                React.createElement("div",null,
                  React.createElement("label",{className:"muted"},"Verkaufspreis (€)"),
                  React.createElement("input",{type:"number",className:"input",value:animalForm.verkaufspreis,onChange:e=>setF("verkaufspreis",e.target.value)})
                ),
                React.createElement("div",null,
                  React.createElement("label",{className:"muted"},"Abgangsgrund"),
                  React.createElement("input",{className:"input",value:animalForm.abgangsgrund,onChange:e=>setF("abgangsgrund",e.target.value)})
                ),
                React.createElement("div",null,
                  React.createElement("label",{className:"muted"},"Abnehmer"),
                  React.createElement("input",{className:"input",value:animalForm.abnehmer,onChange:e=>setF("abnehmer",e.target.value)})
                )
              )
            )
          )
        ),
        React.createElement("div",{className:"border border-amber-300 rounded-lg p-2 bg-amber-50"},
          React.createElement("div",{className:"font-semibold mb-1 text-[11px]"},"Tier-Informationen"),
          React.createElement("div",{className:"grid grid-cols-2 gap-2 text-[11px]"},
            React.createElement("div",null,"Anzahl Belegungen: ",anzahlBeleg),
            React.createElement("div",null,"Anzahl Ferkelungen: ",anzahlFerkelungen),
            React.createElement("div",null,"Anzahl Ferkel gesamt: ",ferkelGesamt),
            React.createElement("div",null,"Anzahl Ferkel lebend: ",ferkelLebend),
            React.createElement("div",null,"Letzte Belegung: ",letzteBelegung||"-"),
            React.createElement("div",null,"Letzte Ferkelung: ",letzteFerkelung||"-"),
            React.createElement("div",null,"Letzte Trächtigkeit: ",letzteTraecht||"-"),
            React.createElement("div",null,"Letzte Absetzung: ",letzteAbsetzung||"-"),
            React.createElement("div",null,"Nächste Belegung: ","—"),
            React.createElement("div",null,"Nächste Ferkelung: ","—")
          )
        )
      ),
      React.createElement("div",{className:"px-4 py-2 border-t bg-amber-100 rounded-b-xl flex justify-between items-center"},
        React.createElement("button",{className:"btn",onClick:onClose},"Abbrechen"),
        React.createElement("button",{className:"btn",onClick:onSave},"OK")
      )
    )
  );
}

const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(React.createElement(App));
</script>
</body>
</html>
